VOID TestWithDump Etalon.ms.script.test
 VOID PROCEDURE Etalon
  ^ IN aLambda
  STRING VAR l_FileName
  VOID PROCEDURE Out
   IN aValue
   g_OutFile
   IsNil
   ?FAIL
   'Файл для вывода не открыт'
   aValue
   ToPrintable
   g_OutFile
   File:WriteLn
  ; // VOID PROCEDURE Out
  
  script:FileName
  l_FileName
  pop:Word:SetValue
  ARRAY [
   l_FileName
   if
    (
     g_EtalonCount
     >
     0
    )
   then
    (
     '.'
     g_EtalonCount
     IntToStr
    )
   '.prn'
  ]
  strings:Cat
  l_FileName
  pop:Word:SetValue
  SaveVarAndDo
  g_OutFile
  (
   l_FileName
   File:OpenWrite
   g_OutFile
   pop:Word:SetValue
   DumpStackTo
   (
    g_EtalonCount
    aLambda
    DO
   )
   Out
  )
  l_FileName
  FileSize
  0
  ==
  ?
  (
   l_FileName
   sysutils:FileExists
   ?
   (
    l_FileName
    DeleteFile
    DROP
   )
  )
  INC
  g_EtalonCount
 ; // VOID PROCEDURE Etalon
 
 INTEGER VAR g_EtalonCount
 Etalon.ms.script.test
 DumpElement
 (
  0
  g_EtalonCount
  pop:Word:SetValue
 )
 Etalon
 script:FileName
 Etalon
 (
  1
  2
  +
 )
; // VOID TestWithDump Etalon.ms.script.test

